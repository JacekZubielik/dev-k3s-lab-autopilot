apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
    annotations:
        argocd.argoproj.io/sync-wave: "3"
        cert-manager.io/cluster-issuer: letsencrypt-staging
        cert-manager.io/common-name: s3.anotherlife.org.pl
        external-dns.alpha.kubernetes.io/hostname: console.s3.anotherlife.org.pl
        external-dns.alpha.kubernetes.io/target: s3.anotherlife.org.pl
        external-dns.alpha.kubernetes.io/ttl: "300"
        kubernetes.io/ingress.class: traefik-external
    name: minio-console-staging
    namespace: traefik
spec:
    entryPoints:
        - websecure
    routes:
        - kind: Rule
          match: Host(`console.s3.anotherlife.org.pl`) && (PathPrefix(`/`))
          middlewares:
            - name: chain-traefik-dashboard
              namespace: traefik
          services:
            - name: minio-console
              port: 9001
              scheme: https
              passHostHeader: true
    tls:
        domains:
            - main: s3.anotherlife.org.pl
              sans:
                - .s3.anotherlife.org.pl
        options:
            name: tls-ver13
            namespace: traefik
        secretName: minio-console-s3-cf-staging

# apiVersion: traefik.io/v1alpha1
# kind: IngressRoute
# metadata:
#     annotations:
#         argocd.argoproj.io/sync-wave: "3"
#         cert-manager.io/cluster-issuer: letsencrypt-staging
#         cert-manager.io/common-name: s3.storage.anotherlife.org.pl
#         external-dns.alpha.kubernetes.io/hostname: s3.storage.anotherlife.org.pl
#         external-dns.alpha.kubernetes.io/target: storage.anotherlife.org.pl
#         external-dns.alpha.kubernetes.io/ttl: "300"
#         kubernetes.io/ingress.class: traefik-external
#     name: s3-staging
#     namespace: traefik
# spec:
#     entryPoints:
#         - websecure
#     routes:
#         - kind: Rule
#           match: Host(`s3.storage.anotherlife.org.pl`)
#           services:
#             - name: minio-proxy
#               port: 9000
#               scheme: https
#               #   passHostHeader: true
#         - kind: Rule
#           match: Host(`console.s3.storage.anotherlife.org.pl`) && (PathPrefix(`/`))
#           middlewares:
#             - name: chain-traefik-dashboard
#               namespace: traefik
#           services:
#             - name: minio-proxy
#               port: 9001
#               scheme: https
#               passHostHeader: true
#     tls:
#         domains:
#             - main: storage.anotherlife.org.pl
#               sans:
#                 - .storage.anotherlife.org.pl
#         options:
#             name: tls-ver13
#             namespace: traefik
#         secretName: minio-console-cf-staging
# apiVersion: traefik.io/v1alpha1
# kind: IngressRoute
# metadata:
#     annotations:
#         argocd.argoproj.io/sync-wave: "3"
#         cert-manager.io/cluster-issuer: letsencrypt-staging
#         cert-manager.io/common-name: s3.storage.anotherlife.org.pl
#         external-dns.alpha.kubernetes.io/hostname: s3.storage.anotherlife.org.pl
#         external-dns.alpha.kubernetes.io/target: storage.anotherlife.org.pl
#         external-dns.alpha.kubernetes.io/ttl: "300"
#         kubernetes.io/ingress.class: traefik-external
#     name: s3-staging
#     namespace: traefik
# spec:
#     entryPoints:
#         - websecure
#     routes:
#         - kind: Rule
#           match: Host(`s3.storage.anotherlife.org.pl`)
#           services:
#             - name: minio-proxy
#               port: 9000
#               scheme: https
#               #   passHostHeader: true
#         - kind: Rule
#           match: Host(`console.s3.storage.anotherlife.org.pl`) && (PathPrefix(`/`))
#           middlewares:
#             - name: chain-traefik-dashboard
#               namespace: traefik
#           services:
#             - name: minio-proxy
#               port: 9001
#               scheme: https
#               passHostHeader: true
#     tls:
#         domains:
#             - main: storage.anotherlife.org.pl
#               sans:
#                 - .storage.anotherlife.org.pl
#         options:
#             name: tls-ver13
#             namespace: traefik
#         secretName: s3-cf-staging
# ---
# apiVersion: traefik.io/v1alpha1
# kind: TraefikService
# metadata:
#     annotations:
#         argocd.argoproj.io/sync-wave: "2"
#     name: s3
# spec:
#     weighted:
#         services:
#             - name: minio
#               port: 9000
#               weight: 1
# ---
# apiVersion: traefik.io/v1alpha1
# kind: TraefikService
# metadata:
#     annotations:
#         argocd.argoproj.io/sync-wave: "2"
#     name: minio-console
# spec:
#     weighted:
#         services:
#             - name: minio-console
#               port: 9001
#               weight: 1
