apiVersion: traefik.io/v1alpha1
kind: IngressRoute
metadata:
    annotations:
        argocd.argoproj.io/sync-wave: "3"
        cert-manager.io/cluster-issuer: letsencrypt-production
        cert-manager.io/common-name: portainer.infra.anotherlife.org.pl
        external-dns.alpha.kubernetes.io/hostname: portainer.infra.anotherlife.org.pl
        external-dns.alpha.kubernetes.io/target: infra.anotherlife.org.pl
        external-dns.alpha.kubernetes.io/ttl: "300"
        kubernetes.io/ingress.class: traefik-external
    name: portainer-production
    namespace: traefik
spec:
    entryPoints:
        - websecure
    routes:
        - kind: Rule
          # || HostRegexp(`{subdomain:[a-z0-9]+}.anotherlife.org.pl`) && PathPrefix(`/outpost.goauthentik.io/`)
          match: Host(`portainer.infra.anotherlife.org.pl`)
          priority: 10
          # middlewares:
          #   - name: chain-authentik
          #     namespace: traefik
          services:
            - name: portainer-proxy
              port: 9443
              scheme: https
              # passHostHeader: true
    # - kind: Rule
    #   match: Host(`portainer.infra.anotherlife.org.pl`) && PathPrefix(`/outpost.goauthentik.io/`)
    #   priority: 15
    #   services:
    #     - kind: Service
    #       name: ak-outpost-example-outpost
    #       port: 9000
    tls:
        domains:
            - main: infra.anotherlife.org.pl
              sans:
                - .infra.anotherlife.org.pl
        options:
            name: tls-ver13
            namespace: traefik
        secretName: portainer-cf-production
